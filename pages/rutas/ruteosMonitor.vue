<template>
  <div id="pageTable">
    <!-- <svg _ngcontent-bjc-c218="" version="1.1" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 1600 1600"><style _ngcontent-bjc-c218="" type="text/css"> .st0 { fill: #064D56; } .st1 { fill: #043843; } .st2 { fill: #3C9CA3; } .st3 { fill: #63C3D1; } .st4 { fill: #00232B; } .st5 { fill: #FFFFFF; } .st6 { fill: #F08125; } .st7 { fill: #1B9162; } .st8 { fill: #AB5099; } .st9 { fill: #375BA6; } .st10 { fill: #4EA1A8; } .st11 { fill: #99A6A9; } .st12 { fill: #667D81; } .st13 { fill: #4D666C; } .st14 { fill: #7F9095; } </style><g _ngcontent-bjc-c218="" class="screen"><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M32.7,673.4v675.1c0,28,29.3,46.3,54.5,34l834.9-408c33.4-16.3,54.6-50.3,54.6-87.5V211.9
			c0-28-29.3-46.3-54.5-34l-834.9,408C53.9,602.2,32.7,636.2,32.7,673.4z" class="st0"></path></g><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M45.8,686.5v675.1c0,28,29.3,46.3,54.5,34l834.9-408c33.4-16.3,54.6-50.3,54.6-87.5V225
			c0-28-29.3-46.3-54.5-34L100.4,599C67,615.3,45.8,649.3,45.8,686.5z" class="st1"></path></g></g><g _ngcontent-bjc-c218="" class="window"><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M600.6,302.6v457.1c0,28,29.3,46.3,54.5,34l209.6-101.8c33.4-16.3,54.6-50.3,54.6-87.5V147.3
			c0-28-29.3-46.3-54.5-34L655.2,215C621.8,231.4,600.6,265.3,600.6,302.6z" class="st2"></path></g><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M609.3,311.3v457.1c0,28,29.3,46.3,54.5,34l209.6-101.8c33.4-16.3,54.6-50.3,54.6-87.5V156
			c0-28-29.3-46.3-54.5-34L663.9,223.8C630.5,240.1,609.3,274.1,609.3,311.3z" class="st3"></path></g></g><g _ngcontent-bjc-c218="" class="list"><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M869.8,836.2c-3.2,0-6.3-1.8-7.8-4.9c-2.1-4.3-0.3-9.5,4-11.7l192.5-94.2c4.4-2.1,9.5-0.3,11.7,4
			c2.1,4.3,0.3,9.5-4,11.7l-192.5,94.2C872.4,835.9,871.1,836.2,869.8,836.2z" class="st3"></path></g><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M869.8,983c-3.2,0-6.3-1.8-7.8-4.9c-2.1-4.3-0.3-9.5,4-11.7l180.2-88.2c4.3-2.1,9.5-0.3,11.7,4
			c2.1,4.3,0.3,9.5-4,11.7l-180.2,88.2C872.4,982.8,871.1,983,869.8,983z" class="st3"></path></g><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M869.8,909.6c-3.2,0-6.3-1.8-7.8-4.9c-2.1-4.3-0.3-9.5,4-11.7l157.7-77.1c4.3-2.1,9.5-0.3,11.7,4
			c2.1,4.3,0.3,9.5-4,11.7l-157.7,77.1C872.4,909.4,871.1,909.6,869.8,909.6z" class="st3"></path></g></g><g _ngcontent-bjc-c218="" class="editor"><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M144.8,743.6v532.3c0,28,29.3,46.3,54.5,34L555.1,1136V543.1L144.8,743.6z" class="st4"></path></g><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M264.6,1211.1c-3.2,0-6.3-1.8-7.8-4.9c-2.1-4.3-0.3-9.5,4-11.7L473,1091c4.3-2.1,9.5-0.3,11.7,4
			c2.1,4.3,0.3,9.5-4,11.7l-212.3,103.5C267.1,1210.8,265.8,1211.1,264.6,1211.1z" class="st5"></path></g><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M144.8,727v16.6l410.2-200.5v-16.8c0-28-29.3-46.3-54.5-34L199.5,639.5C166,655.8,144.8,689.8,144.8,727z" class="st6"></path></g><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M191,817.7c-4,0-7.9-2.2-9.8-6.1c-2.6-5.4-0.4-11.9,5-14.6l159-77.8c5.4-2.7,11.9-0.4,14.6,5
			c2.6,5.4,0.4,11.9-5,14.6l-159,77.8C194.2,817.3,192.6,817.7,191,817.7z" class="st6"></path></g><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M264.6,923.4c-3.2,0-6.3-1.8-7.8-4.9c-2.1-4.3-0.3-9.5,4-11.7L473,803.3c4.3-2.1,9.5-0.3,11.7,4
			c2.1,4.3,0.3,9.5-4,11.7L268.4,922.5C267.1,923.1,265.8,923.4,264.6,923.4z" class="st5"></path></g><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M264.6,851.4c-3.2,0-6.3-1.8-7.8-4.9c-2.1-4.3-0.3-9.5,4-11.7l244.4-119.4c4.3-2.1,9.5-0.3,11.7,4
			c2.1,4.3,0.3,9.5-4,11.7L268.4,850.6C267.1,851.2,265.8,851.4,264.6,851.4z" class="st5"></path></g><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M264.6,1067.2c-3.2,0-6.3-1.8-7.8-4.9c-2.1-4.3-0.3-9.5,4-11.7l244.4-119.4c4.3-2.1,9.5-0.3,11.7,4
			c2.1,4.3,0.3,9.5-4,11.7l-244.4,119.4C267.1,1066.9,265.8,1067.2,264.6,1067.2z" class="st5"></path></g><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M191,1031.3c-3.2,0-6.3-1.8-7.8-4.9c-2.1-4.3-0.3-9.5,4-11.7L325,947.2c4.3-2.1,9.6-0.3,11.7,4
			c2.1,4.3,0.3,9.5-4,11.7l-137.9,67.5C193.6,1031,192.3,1031.3,191,1031.3z" class="st3"></path></g><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M191,1177.3c-4,0-7.9-2.2-9.8-6.1c-2.6-5.4-0.4-11.9,5-14.6l188.7-92.4c5.4-2.7,11.9-0.4,14.6,5
			c2.6,5.4,0.4,11.9-5,14.6l-188.7,92.4C194.2,1176.9,192.6,1177.3,191,1177.3z" class="st6"></path></g></g><g _ngcontent-bjc-c218="" class="code"><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M421.6,1106.5v166.3c0,28,29.4,46.3,54.5,34l202.5-99.3c33.4-16.4,54.5-50.3,54.5-87.5V953.8
			c0-28-29.4-46.3-54.5-34l-202.5,99.3C442.8,1035.4,421.6,1069.3,421.6,1106.5z" class="st2"></path></g><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M430.3,1115.2v166.3c0,28,29.4,46.3,54.5,34l202.5-99.3c33.4-16.4,54.5-50.3,54.5-87.5V962.5
			c0-28-29.4-46.3-54.5-34l-202.5,99.3C451.5,1044.1,430.3,1078.1,430.3,1115.2z" class="st3"></path></g><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M536.3,1233.5c-2.2,0-4.4-0.8-6.1-2.5l-37.1-36.2c-2.7-2.7-3.4-6.8-1.7-10.2l37.1-73.6
			c2.2-4.3,7.4-6,11.7-3.9c4.3,2.2,6,7.4,3.9,11.7l-34.2,67.9l32.5,31.7c3.4,3.4,3.5,8.9,0.2,12.3
			C540.8,1232.7,538.6,1233.5,536.3,1233.5z" class="st4"></path></g><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M649.3,1166.9c-1.3,0-2.7-0.3-3.9-0.9c-4.3-2.2-6-7.4-3.9-11.7l34.2-67.9l-32.5-31.7
			c-3.4-3.4-3.5-8.9-0.2-12.3c3.4-3.5,8.9-3.5,12.3-0.2l37.1,36.2c2.7,2.7,3.4,6.8,1.7,10.2l-37.1,73.6
			C655.5,1165.1,652.5,1166.9,649.3,1166.9z" class="st4"></path></g><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M586.4,1209.9c-0.6,0-1.1-0.1-1.7-0.2c-4.7-0.9-7.8-5.5-6.9-10.2l30.2-152.8c0.9-4.7,5.5-7.8,10.2-6.9
			c4.7,0.9,7.8,5.5,6.9,10.2L595,1202.9C594.1,1207.1,590.5,1209.9,586.4,1209.9z" class="st4"></path></g></g><g _ngcontent-bjc-c218="" class="chart"><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M926.2,651.4c-13,0-25.7-3-37.7-9.1c-8.6-4.3-12.1-14.8-7.7-23.4c4.3-8.6,14.8-12.1,23.4-7.7
			c11.5,5.8,23.8,6.9,36.5,3.2c39-11.3,74.7-54.2,88.8-106.7c2.5-9.3,12.1-14.8,21.4-12.3c9.3,2.5,14.8,12.1,12.3,21.4
			c-17.4,64.9-61.6,116.3-112.7,131.1C942.4,650.2,934.3,651.4,926.2,651.4z" class="st0"></path></g><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M1053.6,474.2c-9.6,0-17.4-7.8-17.4-17.4c0-59.5-24.8-107.4-60.2-116.3c-9.3-2.4-15-11.9-12.6-21.2
			c2.4-9.3,11.9-15,21.2-12.6c51.8,13.1,86.5,73.5,86.5,150.2C1071.1,466.4,1063.3,474.2,1053.6,474.2z" class="st0"></path></g><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M854.4,598.8c-6.4,0-12.6-3.6-15.6-9.7c-12.2-24.6-18.7-54.3-18.7-85.8c0-78.9,40.3-157.6,95.9-187.1
			c8.5-4.5,19.1-1.3,23.6,7.2c4.5,8.5,1.3,19.1-7.2,23.6c-44.1,23.4-77.4,90.6-77.4,156.3c0,26.2,5.2,50.5,15,70.3
			c4.3,8.6,0.7,19.1-7.9,23.4C859.6,598.2,857,598.8,854.4,598.8z" class="st0"></path></g><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M935,660.1c-13,0-25.7-3-37.7-9.1c-8.6-4.3-12.1-14.8-7.7-23.4s14.8-12.1,23.4-7.7
			c11.5,5.8,23.8,6.9,36.5,3.2c39-11.3,74.7-54.2,88.8-106.7c2.5-9.3,12.1-14.8,21.4-12.3c9.3,2.5,14.8,12.1,12.3,21.4
			c-17.4,64.9-61.6,116.3-112.7,131.1C951.1,659,943,660.1,935,660.1z" class="st7"></path></g><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M1062.4,482.9c-9.6,0-17.4-7.8-17.4-17.4c0-59.5-24.8-107.4-60.2-116.3c-9.3-2.4-15-11.9-12.6-21.2
			c2.4-9.3,11.8-15,21.2-12.6c51.8,13.1,86.5,73.5,86.5,150.2C1079.8,475.1,1072,482.9,1062.4,482.9z" class="st8"></path></g><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M863.1,607.5c-6.4,0-12.6-3.6-15.6-9.7c-12.2-24.6-18.7-54.3-18.7-85.8c0-78.9,40.3-157.6,95.9-187.1
			c8.5-4.5,19.1-1.3,23.6,7.2c4.5,8.5,1.3,19.1-7.2,23.6c-44.1,23.4-77.4,90.6-77.4,156.3c0,26.2,5.2,50.5,15,70.3
			c4.3,8.6,0.7,19.1-7.9,23.4C868.4,606.9,865.7,607.5,863.1,607.5z" class="st9"></path></g></g><g _ngcontent-bjc-c218="" class="matrix"><g _ngcontent-bjc-c218=""><ellipse _ngcontent-bjc-c218="" cx="641.8" cy="749.8" rx="10.7" ry="14.7" class="st4"></ellipse></g><g _ngcontent-bjc-c218=""><ellipse _ngcontent-bjc-c218="" cx="641.8" cy="868.4" rx="10.7" ry="14.7" class="st4"></ellipse></g><g _ngcontent-bjc-c218=""><ellipse _ngcontent-bjc-c218="" cx="641.8" cy="809.1" rx="10.7" ry="14.7" class="st4"></ellipse></g><g _ngcontent-bjc-c218=""><ellipse _ngcontent-bjc-c218="" cx="685.4" cy="723.7" rx="10.7" ry="14.7" class="st4"></ellipse></g><g _ngcontent-bjc-c218=""><ellipse _ngcontent-bjc-c218="" cx="685.4" cy="842.3" rx="10.7" ry="14.7" class="st4"></ellipse></g><g _ngcontent-bjc-c218=""><ellipse _ngcontent-bjc-c218="" cx="685.4" cy="783" rx="10.7" ry="14.7" class="st4"></ellipse></g><g _ngcontent-bjc-c218=""><ellipse _ngcontent-bjc-c218="" cx="729" cy="697.5" rx="10.7" ry="14.7" class="st4"></ellipse></g><g _ngcontent-bjc-c218=""><ellipse _ngcontent-bjc-c218="" cx="641.8" cy="690.5" rx="10.7" ry="14.7" class="st4"></ellipse></g><g _ngcontent-bjc-c218=""><ellipse _ngcontent-bjc-c218="" cx="685.4" cy="664.4" rx="10.7" ry="14.7" class="st4"></ellipse></g><g _ngcontent-bjc-c218=""><ellipse _ngcontent-bjc-c218="" cx="729" cy="638.2" rx="10.7" ry="14.7" class="st4"></ellipse></g><g _ngcontent-bjc-c218=""><ellipse _ngcontent-bjc-c218="" cx="729" cy="816.1" rx="10.7" ry="14.7" class="st4"></ellipse></g><g _ngcontent-bjc-c218=""><ellipse _ngcontent-bjc-c218="" cx="729" cy="756.8" rx="10.7" ry="14.7" class="st4"></ellipse></g></g><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M1137.9,390.5c0,0-21.5,98.3-28.1,114.9c-4.7,11.8-33.7,49.8-48.3,68.6l0,0c0,0-15.8,9-39.6,10.2
		c-7.9,0.4-7.5,7.8,8.3,10.3c-0.7,0.8-1.3,1.6-1.8,2.6c-6.3,10.3-15.4,16.3-22.7,28.3c-6.4,10.6,33.7,12.3,68.3-34.9
		c1.9-2.6,3.5-4.9,4.9-7c14.4-11.8,61.5-52.1,66-79.6c5.4-32.4,21.4-96.6,21.4-96.6L1137.9,390.5z" class="st3"></path><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M1568.2,1398.3c0,42.8-102.7,93.6-282.8,93.6s-326.2-49.8-326.2-92.6s217.9-64.6,398.1-64.6
			S1568.2,1355.5,1568.2,1398.3z" class="st1"></path></g><g _ngcontent-bjc-c218=""><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M1250.6,111.3c59.1-4.3,80.2,38.1,70.1,89.4c-11.1,56.2,8.3,81,30.3,101.6c17.2,16.1,23.6,46,9.1,85
				c-11.9,32.2,3.2,50.6-0.3,77.4c-3.7,28.8-52.1,41.3-79,12.8c-26-27.5-19.9-46.2-42.9-54.9c-36.6-13.9-70.5-36.8-61.5-78.5
				c5.8-26.9,39.3-45.4,29.3-80.3C1194.4,224.4,1148.7,118.8,1250.6,111.3z" class="st5"></path></g></g><g _ngcontent-bjc-c218=""><g _ngcontent-bjc-c218=""><polygon _ngcontent-bjc-c218="" points="1236.9,1368.7 1200.4,1368.7 1198,1284.1 1234.5,1284.1 			" class="st3"></polygon></g></g><g _ngcontent-bjc-c218=""><g _ngcontent-bjc-c218=""><polygon _ngcontent-bjc-c218="" points="1381,1368.7 1344.5,1368.7 1332.8,1284.1 1369.3,1284.1 			" class="st3"></polygon></g></g><path _ngcontent-bjc-c218="" d="M1247.8,1399.4l-4.7-32.5c-0.2-1.5-1.4-2.5-2.9-2.5h-41c-0.7,0-1.4,0.1-2.1,0.3c-0.7-3.3-2.1-7.8-4.9-10.2
		c-1.4-1.2-3-1.7-4.8-1.5c-2.4,0.2-3.1,1.5-3.2,2.4c-0.4,2.3,2.2,5.9,5.3,8.9c-4.8-1.9-10.5-3.7-13-2.3c-0.9,0.5-1.4,1.3-1.5,2.3
		c-0.2,1.7,0.4,3.1,1.6,4.2c1.9,1.7,5.2,2.2,8.9,2.2c0.9,0,1.7,0,2.6-0.1c-8.9,6.8-20.6,13.6-44.5,18.7c-6.4,1.4-5.2,16.5,9.8,16.5
		c15.3,0,38.3-1.2,49.4-1.2c18,0,24.9,0.8,39.2,1.1C1245.4,1406,1248.3,1402.8,1247.8,1399.4z M1185.8,1355.8c0-0.2,0.1-0.8,1.7-1
		c0.2,0,0.3,0,0.5,0c1.1,0,2.1,0.4,3,1.1c2.5,2,3.7,6.3,4.3,9.4c-0.5,0.2-0.9,0.5-1.4,0.7C1189.9,1363,1185.5,1358,1185.8,1355.8z
		 M1177.8,1367.3c-0.8-0.7-1.1-1.6-1-2.8c0-0.5,0.2-0.7,0.6-0.9c2.2-1.2,9.1,1.2,14.9,3.8c-0.5,0.5-1.1,0.9-1.7,1.4
		C1184.3,1369.5,1179.6,1369,1177.8,1367.3z" class="st5"></path><g _ngcontent-bjc-c218=""><g _ngcontent-bjc-c218=""><g _ngcontent-bjc-c218=""><polygon _ngcontent-bjc-c218="" points="1198,1284.2 1199.2,1327.7 1235.8,1327.7 1234.5,1284.2 				" class="st10"></polygon></g></g><g _ngcontent-bjc-c218=""><g _ngcontent-bjc-c218=""><polygon _ngcontent-bjc-c218="" points="1369.3,1284.2 1332.8,1284.2 1338.9,1327.7 1375.4,1327.7 				" class="st10"></polygon></g></g></g><g _ngcontent-bjc-c218=""><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M1155.5,326.3c0,0-17.4,6.1,17.5,220.4c58.8,0,119.7,0,148.3,0c-2.5-60.4-2.6-97.6,26.3-221.4
				c0,0-31.1-6.8-63-8.3c-25-1.2-45.4-2-67.3,0C1188.3,319.6,1155.5,326.3,1155.5,326.3z" class="st11"></path></g></g><g _ngcontent-bjc-c218=""><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M1155.5,326.3c-15,3.8-25.6,65.8-25.6,65.8l58.1,39.5c0,0,23.2-73.8,11.6-90.3
				C1187.5,324,1177.5,320.7,1155.5,326.3z" class="st11"></path></g></g><g _ngcontent-bjc-c218=""><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M1289.6,191.8c0.1,34.6-2.4,51.5-20.7,70.1c-27.5,27.9-71.4,17.3-80.1-18.8c-7.8-32.5-2.8-86.2,32.6-100.6
				C1256.4,128.3,1289.5,155.6,1289.6,191.8z" class="st3"></path></g></g><g _ngcontent-bjc-c218=""><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M1212.1,546.7c0,0,3.7,43.3,9.5,104.1c0,0,0,0,0,0c7.1,74.3,17.6,174.5,28.6,253.7c1.7,11.9,3.4,23.3,5,34
				c17.8,114.1,74.8,380.7,74.8,380.7h49.8c0,0-19.3-257.5-28.3-370.4c-22.8-285.5-21.3-298.6-30.3-402.2H1212.1z" class="st12"></path></g></g><g _ngcontent-bjc-c218=""><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M1221.7,650.8C1221.7,650.8,1221.7,650.8,1221.7,650.8c7.1,74.3,17.6,174.6,28.6,253.8
				c11-33.7,31.1-151.7,13.5-255.4C1253.2,586.6,1232.7,614,1221.7,650.8z" class="st13"></path></g></g><g _ngcontent-bjc-c218=""><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M1173,546.7c0,0-15.7,281.3-13.3,392.6c2.5,115.8,31.9,380,31.9,380h49.4c0,0-7.8-257.4-3.4-371.1
				c4.8-124,44.1-401.5,44.1-401.5H1173z" class="st12"></path></g></g><g _ngcontent-bjc-c218=""><g _ngcontent-bjc-c218=""><polygon _ngcontent-bjc-c218="" points="1324.3,1321.8 1385.6,1321.8 1386.7,1300.8 1319.6,1299 			" class="st13"></polygon></g></g><g _ngcontent-bjc-c218=""><g _ngcontent-bjc-c218=""><polygon _ngcontent-bjc-c218="" points="1185.1,1321.8 1246.4,1321.8 1248.7,1299 1180.4,1299 			" class="st13"></polygon></g></g><g _ngcontent-bjc-c218=""><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M1234.3,117.8l74,39.7c-10.5,3.7,6.3,25-2.3,35.7C1292.9,209.6,1216.9,171.4,1234.3,117.8z" class="st5"></path></g></g><g _ngcontent-bjc-c218=""><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M1300.8,206.4c0,7.4-3,14.4-7,19c-5.9,7-12.9,2.9-14.6-5.4c-1.5-7.4-0.3-20,7.3-23.9
				C1294,192.2,1300.8,198,1300.8,206.4z" class="st3"></path></g></g><g _ngcontent-bjc-c218=""><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M1309,390.5c0,0,33.2-4.5,24.8,10.3c-6.3,13.9-10.5,53.1-10.5,53.1L1309,390.5z" class="st14"></path></g></g><path _ngcontent-bjc-c218="" d="M1397.2,1400.7l-9.6-31.7c-0.5-1.6-2-2.7-3.7-2.7l-26,0.4c0.9-3.3,2.1-9.5,0.2-12.8c-0.7-1.2-1.7-2-3.1-2.3
		c-2.1-0.4-3.1,0.7-3.5,1.3c-1.2,2-0.5,6,0.8,9.6c-2.9-2.9-6.4-5.8-8.9-5.5c-0.7,0.1-1.7,0.4-2.4,1.7c-0.9,1.7-0.9,3.4-0.1,4.8
		c0.8,1.4,2.4,2.5,4.3,3.4l-4.3,0.1c-1.5,0-2.8,0.9-3.4,2.3l-13.7,31c-1.1,2.5,0.7,5.3,3.5,5.3h66.4
		C1396.1,1405.6,1397.9,1403.1,1397.2,1400.7z M1352.9,1353.8c0.2-0.4,0.6-0.8,1.7-0.5c0.1,0,0.3,0.1,0.4,0.1
		c0.7,0.2,1.2,0.7,1.6,1.3c1.6,2.7,0.4,8.6-0.5,12C1353.6,1362.9,1351.6,1356,1352.9,1353.8z M1342.2,1362.7c-0.5-0.9-0.5-2,0.2-3.2
		c0.3-0.7,0.7-0.8,1-0.8c2.3-0.2,6.9,4.2,10.3,8.1l-3.2,0.1C1346.1,1365.8,1343.2,1364.4,1342.2,1362.7z" class="st5"></path><g _ngcontent-bjc-c218=""><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M1323.4,553.6l-153.4-2.7c-0.4,0-0.8-0.4-0.7-0.8l0.3-15.1c0-0.4,0.4-0.8,0.8-0.7l153.4,2.7
				c0.4,0,0.8,0.4,0.7,0.8l-0.3,15.1C1324.2,553.3,1323.8,553.6,1323.4,553.6z" class="st5"></path></g></g><path _ngcontent-bjc-c218="" d="M1400.3,498.2c-0.9-33.5-40.4-119.7-40.4-119.7l-35.3,27.4c0,0,27.9,51.9,43.7,81.1
		c7.8,14.4-34.3,27-43.5,29.6c-2.5-2.4-6.1-4-10.9-4c-11.1,0-24.7,4-24.7,10.5s17.5,20.9,28.6,20.9c10.4,0,11.6-8.4,11.7-14.9
		C1349.2,528.8,1401.1,525.5,1400.3,498.2z" class="st3"></path><g _ngcontent-bjc-c218=""><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M1283.3,236.9c-4.2,21.7-13.8,65.6,1.3,80c0,0-5.9,22-46.2,22c-44.3,0-21.2-22-21.2-22
				c24.2-5.8,23.5-23.7,19.3-40.5L1283.3,236.9z" class="st3"></path></g></g><g _ngcontent-bjc-c218=""><g _ngcontent-bjc-c218=""><path _ngcontent-bjc-c218="" d="M1347.5,325.2c15.2,3.3,35.6,59.1,35.6,59.1l-64,36.9c0,0-18.7-43.8-11.5-62.6
				C1315.2,339,1329.6,321.3,1347.5,325.2z" class="st11"></path></g></g></g></svg> -->
    <v-container grid-list-md fluid>
      <v-layout row wrap>
        <v-flex xs12>
          <v-card>
            <!-- presentacion -->
            <v-layout v-bind="binding">
              <v-flex pa-4 class="text-xs-center">
                <img
                  style="max-width: 100%; height: auto"
                  src="~/static/img/hi.gif"
                />
              </v-flex>
              <v-flex>
                <v-card-title primary-title>
                  <div>
                    <div class="font-weight-medium">Bienvenido</div>
                    <div class="headline primary--text text-uppercase">
                      {{
                        $store.state.auth.authUser
                          ? $store.state.auth.authUser.name
                          : 'Desconocido'
                      }}
                    </div>
                    <span
                      >Este es tu panel de control, donde podras visualizar
                      todas tus Rutas abiertas y Disponibles, ademas de otros
                      datos importantes.</span
                    >
                  </div>
                </v-card-title>
              </v-flex>
            </v-layout>
            <v-divider light></v-divider>
            <!-- cuadritos informativos -->
            <v-card-actions class="pa-3">
              <v-layout align-space-around justify-space-around row fill-height>
                <mk-simple-card
                  title="Rutas Disponibles"
                  :text="lRuteos.dispon ? lRuteos.dispon.ok + '' : '0'"
                  color="red darken-4 grey--text"
                ></mk-simple-card>

                <mk-simple-card
                  title="Rutas Abiertas"
                  :text="lRuteos.open ? lRuteos.open.ok + '' : '0'"
                  color="yellow darken-4"
                ></mk-simple-card>

                <mk-simple-card
                  title="Rutas Cerradas"
                  :text="lRuteos.closed ? lRuteos.closed.ok + '' : '0'"
                  color="green darken-4 grey--text"
                ></mk-simple-card>

                <v-icon :color="location ? 'green' : 'grey'"
                  >my_location</v-icon
                >
              </v-layout>
            </v-card-actions>
          </v-card>
        </v-flex>
      </v-layout>
      <!-- Rutas Disponibles -->
      <v-card>
        <v-toolbar color="green darken-4" dark>
          <v-icon>add_location_alt</v-icon>
          <v-toolbar-title>Rutas Disponibles</v-toolbar-title>
          <v-spacer></v-spacer>
        </v-toolbar>
        <v-list two-line>
          <v-list-tile
            v-for="ruta in lRuteos.dispon.data"
            :key="ruta.id"
            href="#"
          >
            <v-list-tile-avatar>
              <v-btn icon flat color="success" @click="verMapa(ruta, true)">
                <v-badge
                  :value="
                    getDataLista(lRutas, ruta.rutas_id, 'id', 'beneficiarios')
                  "
                  color="cyan"
                  overlap
                >
                  <template v-slot:badge>
                    <span>
                      {{
                        getDataLista(
                          lRutas,
                          ruta.rutas_id,
                          'id',
                          'beneficiarios'
                        ).length
                      }}</span
                    >
                  </template>
                  <v-icon large>map</v-icon>
                </v-badge>
              </v-btn>
            </v-list-tile-avatar>
            <v-list-tile-content>
              <v-list-tile-title>
                <v-layout row wrap>
                  <v-flex>
                    <span class="caption">
                      {{ ruta.id }}
                    </span>
                    <span class="title text-capitalize">
                      {{ getDataLista(lRutas, ruta.rutas_id) }}</span
                    >
                  </v-flex>
                </v-layout>
              </v-list-tile-title>
              <v-list-tile-sub-title class="caption">{{
                getDataLista(lRutas, ruta.rutas_id, 'id', 'descrip')
              }}</v-list-tile-sub-title>
            </v-list-tile-content>
            <v-list-tile-action>
              <v-btn icon color="primary" @click="addRuteo(ruta)">
                <v-icon>add</v-icon>
              </v-btn>
            </v-list-tile-action>
          </v-list-tile>
        </v-list>
      </v-card>
      <br />
      <!-- Rutas Abiertas -->
      <v-card>
        <v-toolbar color="yellow darken-4" dark>
          <v-icon>pin_drop</v-icon>
          <v-toolbar-title>Rutas Abiertas</v-toolbar-title>
        </v-toolbar>
        <v-list two-line dense>
          <v-list-group
            v-model="ruteo.active"
            v-for="ruteo in lRuteos.open.data"
            :key="ruteo.id"
            active-class="grey"
          >
            <v-list-tile slot="activator">
              <v-list-tile-avatar>
                <v-btn
                  icon
                  flat
                  color="success"
                  @click.stop="
                    verMapa(
                      getDataLista(lRutas, ruteo.rutas_id, 'id', '*'),
                      true
                    )
                  "
                >
                  <v-badge :value="true" color="cyan" overlap>
                    <template v-slot:badge>
                      <span>
                        {{
                          getDataLista(
                            lRutas,
                            ruteo.rutas_id,
                            'id',
                            'beneficiarios'
                          ).length
                        }}
                      </span>
                    </template>
                    <v-icon large>map</v-icon>
                  </v-badge>
                </v-btn>
              </v-list-tile-avatar>
              <v-list-tile-content>
                <v-list-tile-title>
                  <v-layout row wrap>
                    <v-flex>
                      <span class="caption">
                        {{ ruteo.id }}
                      </span>
                      <span class="title text-capitalize">
                        {{ getDataLista(lRutas, ruteo.rutas_id) }}
                      </span>
                    </v-flex>
                  </v-layout>
                </v-list-tile-title>
                <v-list-tile-sub-title class="caption">
                  Abierto: {{ formatDT(ruteo['created_at']) }}
                </v-list-tile-sub-title>
              </v-list-tile-content>
              <v-list-tile-action>
                <v-btn
                  icon
                  color="primary"
                  @click.stop=""
                  large
                  v-if="
                    getDataLista(lRutas, ruteo.rutas_id, 'id', 'beneficiarios')
                      .length -
                      ruteo.evaluaciones.length >
                    0
                  "
                >
                  <v-badge :value="true" color="green" overlap>
                    <template v-slot:badge>
                      <span>
                        {{
                          getDataLista(
                            lRutas,
                            ruteo.rutas_id,
                            'id',
                            'beneficiarios'
                          ).length - ruteo.evaluaciones.length
                        }}
                      </span>
                    </template>
                    <v-icon large>groups</v-icon>
                  </v-badge>
                </v-btn>
                <v-btn
                  v-else
                  icon
                  color="primary"
                  @click.stop="getPosition(setClose, ruteo.id)"
                  large
                  title="Cerrar Ruteo"
                >
                  <v-icon large>fact_check</v-icon>
                </v-btn>
              </v-list-tile-action>
            </v-list-tile>
            <v-list-tile
              v-for="bene in getDataLista(
                lRutas,
                ruteo.rutas_id,
                'id',
                'beneficiariosD'
              )"
              :key="bene.id"
              href="#"
            >
              <v-list-tile-avatar class="pa-0 pm-0">
                <v-btn
                  icon
                  color="green"
                  @click="verMapaBene(bene.id)"
                  small
                  style="margin: 0; margin-right: 3px"
                >
                  <v-icon>person_pin_circle</v-icon>
                </v-btn>
                <v-btn
                  icon
                  color="blue"
                  @click="verMapaBene(bene.id, true)"
                  small
                  style="margin: 0; margin-left: 3px"
                >
                  <v-icon>directions_car</v-icon>
                </v-btn>
              </v-list-tile-avatar>

              <v-list-tile-content>
                <v-list-tile-title>
                  <span class="caption"> {{ ruteo.id }}</span>
                  {{ getDataLista(lBeneficiarios, bene.id) }}
                </v-list-tile-title>
                <v-list-tile-sub-title class="caption">
                  {{ (bene.distancia * 1.0).toFixed(2) }} Km
                </v-list-tile-sub-title>
              </v-list-tile-content>
              <v-list-tile-action> </v-list-tile-action>

              <v-list-tile-action>
                <v-btn
                  icon
                  :color="getColorEval(ruteo, bene.id)"
                  @click="openEval(ruteo, bene.id)"
                >
                  <v-icon>assignment</v-icon>
                </v-btn>
              </v-list-tile-action>
            </v-list-tile>
          </v-list-group>
        </v-list>
      </v-card>
      <br />
      <!-- Rutas Atrasadas  -->
      <v-card>
        <v-toolbar color="red darken-4" dark>
          <v-icon>fmd_bad</v-icon>
          <v-toolbar-title>Rutas Atrasadas </v-toolbar-title>
        </v-toolbar>
        <v-list two-line dense>
          <v-list-group
            v-model="ruteo1.active"
            v-for="ruteo1 in lRuteos.retrased.data"
            :key="ruteo1.id"
            active-class="grey"
          >
            <v-list-tile slot="activator">
              <v-list-tile-avatar>
                <v-btn
                  icon
                  flat
                  color="success"
                  @click.stop="
                    verMapa(
                      getDataLista(lRutas, ruteo1.rutas_id, 'id', '*'),
                      true
                    )
                  "
                >
                  <v-badge :value="true" color="cyan" overlap>
                    <template v-slot:badge>
                      <span>
                        {{
                          getDataLista(
                            lRutas,
                            ruteo1.rutas_id,
                            'id',
                            'beneficiarios'
                          ).length
                        }}
                      </span>
                    </template>
                    <v-icon large>map</v-icon>
                  </v-badge>
                </v-btn>
              </v-list-tile-avatar>
              <v-list-tile-content>
                <v-list-tile-title>
                  <v-layout row wrap>
                    <v-flex>
                      <span class="caption">
                        {{ ruteo1.id }}
                      </span>
                      <span class="title text-capitalize">
                        {{ getDataLista(lRutas, ruteo1.rutas_id) }}
                      </span>
                    </v-flex>
                  </v-layout>
                </v-list-tile-title>
                <v-list-tile-sub-title class="caption">
                  {{ getSubHeader(ruteo1) }}
                </v-list-tile-sub-title>
              </v-list-tile-content>
              <v-list-tile-action>
                <v-btn icon color="primary" @click.stop="" large>
                  <v-badge :value="true" color="green" overlap>
                    <template v-slot:badge>
                      <span>
                        {{
                          getDataLista(
                            lRutas,
                            ruteo1.rutas_id,
                            'id',
                            'beneficiarios'
                          ).length - ruteo1.evaluaciones.length
                        }}
                      </span>
                    </template>
                    <v-icon large>groups</v-icon>
                  </v-badge>
                </v-btn>
              </v-list-tile-action>
            </v-list-tile>
            <v-list-tile
              v-for="bene in getDataLista(
                lRutas,
                ruteo1.rutas_id,
                'id',
                'beneficiariosD'
              )"
              :key="bene.id"
              href="#"
            >
              <v-list-tile-avatar class="pa-0 pm-0">
                <v-btn
                  icon
                  color="green"
                  @click="verMapaBene(bene.id)"
                  small
                  style="margin: 0; margin-right: 3px"
                >
                  <v-icon>person_pin_circle</v-icon>
                </v-btn>
                <v-btn
                  icon
                  color="blue"
                  @click="verMapaBene(bene.id, true)"
                  small
                  style="margin: 0; margin-left: 3px"
                >
                  <v-icon>directions_car</v-icon>
                </v-btn>
              </v-list-tile-avatar>

              <v-list-tile-content>
                <v-list-tile-title>
                  {{ getDataLista(lBeneficiarios, bene.id) }}
                </v-list-tile-title>
                <v-list-tile-sub-title class="caption">
                  {{ (bene.distancia * 1.0).toFixed(2) }} Km
                </v-list-tile-sub-title>
              </v-list-tile-content>
              <v-list-tile-action> </v-list-tile-action>

              <v-list-tile-action>
                <v-btn
                  icon
                  :color="getColorEval(ruteo1, bene.id)"
                  @click="openEval(ruteo1, bene.id)"
                >
                  <v-icon>assignment</v-icon>
                </v-btn>
              </v-list-tile-action>
            </v-list-tile>
          </v-list-group>
        </v-list>
      </v-card>
      <br />
      <!-- Rutas Cerradas -->
      <v-card>
        <v-toolbar color="blue darken-4" dark>
          <v-icon>where_to_vote</v-icon>
          <v-toolbar-title>Rutas Cerradas en estas 2 semanas</v-toolbar-title>
          <v-spacer></v-spacer>
        </v-toolbar>
        <v-list tree-line>
          <v-list-tile
            v-for="rutaC in lRuteos.closed.data"
            :key="rutaC.id"
            href="#"
          >
            <v-list-tile-content>
              <v-list-tile-title>
                <v-layout row wrap>
                  <v-flex>
                    <span class="caption">
                      {{ rutaC.id }}
                    </span>
                    <span class="title text-capitalize">
                      {{ getDataLista(lRutas, rutaC.rutas_id) }}
                    </span>
                    <span class="caption">
                      {{
                        getDataLista(lRutas, rutaC.rutas_id, 'id', 'descrip')
                      }}
                    </span>
                  </v-flex>
                </v-layout>
              </v-list-tile-title>
              <v-list-tile-sub-title class="caption">
                Abierto el:
                {{ formatDT(rutaC.created_at) }}
              </v-list-tile-sub-title>
              <v-list-tile-sub-title class="caption">
                Cerrado el:
                {{ formatDT(rutaC.fec_cerrado) }}
              </v-list-tile-sub-title>
            </v-list-tile-content>
          </v-list-tile>
        </v-list>
      </v-card>
      <br />
      <!-- formulario Principal -->
      <mk-form
        ref="mkForm"
        :modal="modal"
        :tit="tituloModal"
        :accion="accion"
        @closeDialog="closeDialog"
        @grabarItem="grabarItem"
      >
        <v-container grid-list-md fluid>
          <v-text-field
            label="Observaciones"
            v-model="item.obs"
            ref="focus"
          ></v-text-field>
        </v-container>
      </mk-form>
      <!-- formulario Mapa FullScreen -->
      <mk-form-full-screen
        ref="mkFormMap"
        :modal="modalMap"
        :tit="tituloModal"
        accion="show"
        @closeDialog="modalMap = false"
      >
        <v-container grid-list-md fluid ma-o pa-0>
          <div id="map-wrap" style="height: 100%; width: 100%">
            <client-only>
              <l-map
                :zoom="zoom"
                :center="center"
                style="height: 100%; width: 100%"
                ref="mymap"
              >
                <l-tile-layer
                  url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
                  attribution="<a href='http://osm.org/copyright'>OpenStreetMap</a> contributors"
                  :useCors="false"
                ></l-tile-layer>
                <l-polyline
                  v-if="jsonLine"
                  :lat-lngs="jsonLine"
                  color="blue"
                ></l-polyline>
                <l-geo-json
                  v-if="jsonData"
                  :geojson="jsonData"
                  :options-style="styleFunction"
                />
                <div v-if="modalMap && markers && markers.length > 0">
                  <l-marker
                    v-for="(marker, index) in markers"
                    :key="index"
                    :lat-lng="getMarker(marker, item, index)"
                    :draggable="false"
                    :visible="true"
                    :icon="getIcon(marker)"
                  >
                    <l-tooltip>{{
                      getDataLista(lBeneficiarios, marker, 'id', 'name') ||
                      'Tu ubicacion Actual'
                    }}</l-tooltip>
                  </l-marker>
                </div>
              </l-map>
            </client-only>
          </div>
        </v-container>
      </mk-form-full-screen>
      <!-- formulario Evaluaciones FullScreen -->
      <mk-form-full-screen
        ref="mkFormEval"
        :modal="modalEval"
        :tit="tituloModal"
        :accion="accion"
        @closeDialog="modalEval = false"
        @grabarItem="grabarEval"
      >
        <v-container grid-list-md fluid>
          <v-switch
            v-model="estado"
            label="Se Puede resalizar la evaluacion?"
            color="indigo"
          >
          </v-switch>
          <v-text-field
            label="Notas de la Evaluacion"
            v-model="item.obs"
            ref="focusEval"
            :rules="this.estado ? [] : [this.rules.required]"
            validate-on-blur
          ></v-text-field>

          <template v-if="estado && modalEval">
            <v-tabs centered color="indigo" dark icons-and-text>
              <v-tabs-slider color="yellow"></v-tabs-slider>

              <v-tab href="#tab-1" elevation-10>
                Encuesta
                <v-icon>content_paste</v-icon>
              </v-tab>

              <v-tab href="#tab-2" elevation-10>
                Servicios
                <v-icon>plumbing</v-icon>
              </v-tab>

              <v-tab-item value="tab-1">
                <v-card v-for="categ in lCateg" :key="categ.id" elevation-5>
                  <v-toolbar color="secondary" dark dense>
                    <v-toolbar-side-icon></v-toolbar-side-icon>
                    <v-toolbar-title> {{ categ.name }}</v-toolbar-title>
                  </v-toolbar>

                  <div
                    v-for="pregunta in lPregCateg(categ.id)"
                    :key="pregunta.pregunta"
                  >
                    <v-layout row wrap pa-2>
                      <v-flex grow>
                        <span class="title text-capitalize">
                          {{ pregunta.pregunta }}
                        </span>
                      </v-flex>
                      <v-flex shrink>
                        <v-text-field
                          v-if="pregunta.tipo == 2"
                          label="valor"
                          v-model="item.respuestas[pregunta.id]"
                          :rules="[rules.required, rules.num]"
                          validate-on-blur
                          type="number"
                          style="width: 80px"
                        ></v-text-field>

                        <v-radio-group
                          v-if="pregunta.tipo == 1"
                          v-model="item.respuestas[pregunta.id]"
                          row
                          :rules="[rules.required]"
                          validate-on-blur
                        >
                          <v-radio color="green" label="Si" value="1"></v-radio>
                          <v-radio color="red" label="No" value="0"></v-radio>
                        </v-radio-group>
                      </v-flex>
                    </v-layout>
                    <v-divider></v-divider>
                  </div>
                </v-card>
              </v-tab-item>
              <v-tab-item value="tab-2">
                <v-card>
                  <v-list>
                    <template v-for="servicio in lServicios">
                      <v-list-tile
                        :key="servicio.id"
                        :class="
                          servicio.selected
                            ? 'deep-purple lighten-5 deep-purple--text text--accent-4'
                            : ''
                        "
                      >
                        <v-list-tile-action>
                          <v-checkbox
                            v-if="servicio.estado == 1"
                            v-model="servicio.selected"
                            color="deep-purple accent-4"
                          ></v-checkbox>
                        </v-list-tile-action>

                        <v-list-tile-content>
                          <v-list-tile-title>
                            {{ servicio.name }}
                            <span style="font-size: 10px">
                              {{ servicio.obs }}
                              {{ servicio.estado }}
                            </span>
                          </v-list-tile-title>
                        </v-list-tile-content>
                        <v-list-tile-avatar v-if="servicio.selected">
                          <v-text-field
                            v-model="servicio.cantidad"
                            :disabled="
                              servicio.estado == 1
                                ? servicio.cant
                                  ? false
                                  : true
                                : true
                            "
                            :rules="[
                              rules.required,
                              rules.num,
                              rules.minVal(1),
                            ]"
                            validate-on-blur
                            color="primary"
                            :class="servicio.selectded ? 'secondary' : ''"
                            type="number"
                            min="1"
                            style="
                              font-size: 12px;
                              padding-bottom: 0;
                              padding-top: 12px;
                            "
                          ></v-text-field>
                        </v-list-tile-avatar>
                      </v-list-tile>
                    </template>
                  </v-list>
                </v-card>
              </v-tab-item>
            </v-tabs>
          </template>
        </v-container>
      </mk-form-full-screen>
    </v-container>
  </div>
</template>

<script>
import MkModuloMix from '@/components/mkComponentes/mixins/MkModuloMix'
import VWidget from '@/components/VWidget'
import MkSimpleCard from '~/components/mkComponentes/mkCards/mkSimpleCard.vue'
import { TargomoClient } from '@targomo/core'
import {
  getDataLista,
  getDistancia,
  formatDT,
} from '@/components/mkComponentes/lib/MkUtils.js'
import { icon } from 'leaflet'
import {
  getCache,
  setCache,
  getCacheKey,
} from '@/components/mkComponentes/lib/MkCache.js'
import MkFormFullScreen from '~/components/mkComponentes/MkFormFullScreen.vue'
const _dirty = process.env.mkConfig.dirty

export default {
  //middleware: ['authAccess'],
  mixins: [MkModuloMix],
  components: { VWidget, MkSimpleCard, MkFormFullScreen },
  name: 'RuteosMonitor',
  disModTable: true,
  data() {
    return {
      urlModulo: 'Ruteos',
      //titModulo: '',
      location: false,
      lUsuarios: [],
      lRuteos: {
        dispon: {
          ok: 0,
          data: [],
        },
        open: {
          ok: 0,
          data: [],
        },
        closed: {
          ok: 0,
          data: [],
        },
        retrased: {
          ok: 0,
          data: [],
        },
      },
      lRutas: [],
      estado: false,
      lBeneficiarios: [],
      lServicios: [],
      lCateg: [],
      lPreguntas: [],
      modalMap: false,
      modalEval: false,
      center: [-17.783373986957255, -63.18209478792436],
      zoom: 13,
      coordenadas: {},
      markers: [],
      icon1: icon({
        iconUrl: require('~/static/img/icon1.png'),
        iconSize: [32, 32],
        iconAnchor: [16, 30],
        tooltipAnchor: [16, -22],
      }),
      icon2: icon({
        iconUrl: require('~/static/img/icon2.png'),
        iconSize: [32, 32],
        iconAnchor: [16, 30],
        tooltipAnchor: [16, -22],
      }),
      styleFunction: { color: '#000', weight: 5, opacity: 0.5 },
      jsonData: [],
      jsonLine: [],
      item: { respuestas: {} },
      callBack: false,
    }
  },
  methods: {
    grabarEval() {
      if (!this.$refs.mkFormEval.$refs.form.validate()) {
        return false
      }

      this.item.servicios = {}
      this.lServicios.forEach((e) => {
        if (e.selected && e.estado == 1) {
          this.item.servicios[e.id] = e.cantidad
        }
      })

      let data = {
        _noData: 1,
        id: this.item.id,
        obs: this.item.obs,
        lat: this.coordenadas.latitude,
        lng: this.coordenadas.longitude,
        estado: this.estado ? 2 : 1,
        usuarios_id: this.$store.state.auth.authUser.id,
        ruteos_id: this.item.ruteos_id,
        beneficiarios_id: this.item.beneficiarios_id,
        respuestas: this.item.respuestas,
        servicios: this.item.servicios,
      }
      if (
        this.item.id > 0 &&
        JSON.stringify(this.dirty.item.servicios) !=
          JSON.stringify(this.item.servicios)
      ) {
        data.benef = this.item.beneficiarios_id
      }
      //console.log(this.item, data)

      this.item = data

      if (!this.can('add', true)) {
        return false
      }

      this.urlModulo = 'Evaluaciones'
      this.grabarItem()
      this.urlModulo = 'Ruteos'
      return true
    },
    setClose(id) {
      if (!this.can('edit', true)) {
        return false
      }
      let me = this
      let url = 'RuteosMonitor/setClose'
      me.dataTable.loading = true
      me.$axios
        .post(url + this.getCt(url), {
          id: id,
          lat: this.coordenadas.latitude,
          lng: this.coordenadas.longitude,
        })
        .then(function (response) {
          if (me.isOk(response.data)) {
            me.afterSave(me, 0)
          } else {
            //con error
          }
        })
        .catch(function (error) {
          console.error(error)
        })
        .finally(function () {
          me.dataTable.loading = false
        })
    },
    getColorEval(ruteo, bene) {
      return !getDataLista(
        ruteo.evaluaciones,
        bene,
        'beneficiarios_id',
        'estado'
      )
        ? 'red'
        : getDataLista(ruteo.evaluaciones, bene, 'beneficiarios_id', 'verif')
        ? 'greem'
        : 'yellow'
    },
    openEval(data, bene) {
      if (!this.can('add', true)) {
        return false
      }
      this.getPosition()
      this.item = Object.assign({}, data)
      this.item._noData = 1
      this.item.lat = this.coordenadas.latitude
      this.item.beneficiarios_id = bene
      this.item.lng = this.coordenadas.longitude
      this.item.usuarios_id = this.$store.state.auth.authUser.id
      this.item.ruteos_id = data.id
      this.item.obs = ''
      this.item.id = null
      this.item.estado = 0
      let evaluacion = getDataLista(
        this.item.evaluaciones,
        bene,
        'beneficiarios_id',
        '*'
      )

      this.item.servicios = {}
      this.lServicios.forEach((e) => {
        e.cantidad = 1
        e.selected = false
        e.estado = 1

        if (evaluacion) {
          let existe = getDataLista(
            evaluacion.servicios,
            e.id,
            'servicios_id',
            '*'
          )
          if (existe) {
            e.cantidad = existe.cant
            e.selected = true
            e.estado = existe.estado
            if (existe.estado == 1) {
              this.item.servicios[e.id] = existe.cant
            }
          }
        }
      })

      this.item.respuestas = {}
      this.lPreguntas.forEach((e) => {
        if (evaluacion) {
          this.item.respuestas[e.id] = getDataLista(
            evaluacion.respuestas,
            e.id,
            'preguntas_id',
            'r_s',
            ''
          )
        } else {
          this.item.respuestas[e.id] = ''
        }
      })

      this.dirty.item = null
      if (evaluacion) {
        this.item.id = evaluacion.id
        this.item.estado = 1 * evaluacion.estado
        this.item.obs = evaluacion.obs
        if (_dirty) {
          this.dirty.item = JSON.parse(JSON.stringify(this.item))
        }
      }
      this.estado = this.item.estado <= 1 ? false : true

      this.$refs.mkFormEval.$refs.form.resetValidation()
      this.tituloModal =
        'Evaluacion de ' + getDataLista(this.lBeneficiarios, bene) //colocar computada de acuerdo al tamano
      this.modalEval = true
      //this.$nextTick(this.$refs.focus.focus)
    },
    formatDT(d,time=true) {
      return formatDT(d,time)
    },
    getSubHeader(data) {
      return 'Abierto:' + this.formatDT(data.created_at)
    },
    async getRutasOptimizada(ruta) {
      let store = [
        {
          uuid: 'inicio',
          address: {
            lat: this.coordenadas.latitude,
            lng: this.coordenadas.longitude,
          },
        },
      ]
      let orders = ruta.beneficiarios.map((f) => {
        return {
          uuid: getDataLista(this.lBeneficiarios, f),
          storeUuid: 'inicio',
          priority: 1,
          address: {
            lat: getDataLista(this.lBeneficiarios, f, 'id', 'lat'),
            lng: getDataLista(this.lBeneficiarios, f, 'id', 'lng'),
            avgHandlingTime: 1,
          },
        }
      })

      let cacheKey = 'rutasCached_' + getCacheKey([store, orders])

      let cached = getCache(cacheKey)
      console.log('consultando cacheado:', cacheKey, cached)
      if (cached) {
        this.jsonLine = null
        this.jsonData = cached
        console.log('rutas recuperadas del cache')
        //TODO: aqui otra formula para calcular habra que primero calcular elmas cercano del inicio y de ahi calcular todo de nuevo las distancias espaciales recursivamente hasta tener todo ordenado por distancia espacial..
        // let camino='';
        // ruta.beneficiarios.map(e=>{
        //   camino=camino+getDataLista(this.lBeneficiarios, e,'id','lat')+','+getDataLista(this.lBeneficiarios, e,'id','lng')+'/'
        // })
        // camino='https://www.google.com/maps/dir/'+camino+'/@'+this.coordenadas.latitude+','+this.coordenadas.longitude+',13z/data=!4m2!4m1!3e0'
        // console.log('camino',camino)

        return true
      }

      if (this.$nuxt.isOffline) {
        return false
      }

      const client = new TargomoClient('south_america', 'DF6SNYWF3ENCGQGGWEKU')
      const routingConfig = {
        optimizationAlgorithm: 'GREEDY_TSP',
        optimizationTime: 1,
        stores: store,
        orders: orders,
        transports: [
          {
            vehicle: {
              uuid: 'v1',
              storeUuid: 'inicio',
              priority: 1,
            },
          },
        ],
        optimizationMetadata: {
          geojsonCreation: 'ROUTING_SERVICE',
          travelOptions: {
            travelType: 'car',
            maxEdgeWeight: 1800,
            serviceUrl: 'https://api.targomo.com/south_america/',
            serviceKey: client.serviceKey,
          },
        },
      }

      //TODO: aqui otra formula para calcular habra que primero calcular elmas cercano del inicio y de ahi calcular todo de nuevo las distancias espaciales recursivamente hasta tener todo ordenado por distancia espacial..
      // let camino='';
      // ruta.beneficiarios.map(e=>{
      //   camino=camino+getDataLista(this.lBeneficiarios, e,'id','lat')+','+getDataLista(this.lBeneficiarios, e,'id','lng')+'/'
      // })
      // camino='https://www.google.com/maps/dir/'+camino+'/@'+this.coordenadas.latitude+','+this.coordenadas.longitude+',13z/data=!4m2!4m1!3e0'
      // console.log('camino',camino)

      const url = `https://api.targomo.com/fleetplanner/v1/api/key-auth/optimizations?key=${client.serviceKey}`
      try {
        const data = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(routingConfig),
        })
        const r = await data.json()
        //  console.log(r)

        let dd = [] //assign.Object([],r.tours[0].featureCollection.features)
        r.tours[0].featureCollection.features.forEach((d) => {
          if (d.geometry.type != 'Point') {
            dd.push(d)
          }
        })
        r.tours[0].featureCollection.features = dd
        this.jsonLine = null
        this.jsonData = r.tours[0].featureCollection
        setCache(cacheKey, this.jsonData)
      } catch (error) {
        console.error(error)
      }
    },
    distancia(d) {
      if (!d) {
        return -1
      }
      return getDistancia(
        this.coordenadas.latitude,
        this.coordenadas.longitude,
        d.lat,
        d.lng
      )
    },
    async afterSave(me, isError = 0) {
      if (isError != 1) {
        me.lRuteos = await this.getListaBackend('RuteosMonitor')
      }
      if (isError >= 0) {
        this.modalEval = false
        //modalMap=false;
      }
      return true
    },
    addRuteo(data) {
      if (!this.can('add', true)) {
        return false
      }
      this.item = Object.assign({}, data)
      this.item.lat = this.coordenadas.latitude
      this.item.lng = this.coordenadas.longitude
      this.item.usuarios_id = this.$store.state.auth.authUser.id
      this.item.rutas_id = data.id
      this.item._noData = 1
      this.item.obs = ''
      this.item.id = null

      this.$refs.mkForm.$refs.form.resetValidation()
      this.tituloModal =
        'Abrir Ruteo para ' + getDataLista(this.lRutas, this.item.rutas_id)
      this.modal = true
      this.$nextTick(this.$refs.focus.focus)
    },
    vermapaGoogle() {
      //
    },
    verMapaBene(bene, google = false) {
      this.getPosition()
      let benef = getDataLista(this.lBeneficiarios, bene, 'id', '*')
      console.log(
        'hola',
        [this.coordenadas.latitude, this.coordenadas.longitude],
        [benef.lat, benef.lng]
      )

      if (!google) {
        this.markers = [0, bene]
        this.jsonData = [
          {
            type: 'LineString',
            coordinates: [
              [this.coordenadas.longitude, this.coordenadas.latitude],
              [benef.lng, benef.lat],
            ],
          },
        ]

        this.tituloModal = 'Ubicacion de ' + benef.name
        //this.jsonData = null
        this.modalMap = true
        setTimeout(() => {
          this.initMap()
        }, 300)
      } else {
        let url =
          'https://www.google.com/maps/dir/?api=1&origion=' +
          this.coordenadas.latitude +
          ',' +
          this.coordenadas.longitude +
          '&destination=' +
          benef.lat +
          ',' +
          benef.lng +
          '&dir_action=navigate'
        window.open(url)
      }
    },
    verMapa(data, posAct = false) {
      this.jsonData = []
      this.jsonLine = null
      this.markers = Object.assign([], data.beneficiarios)
      this.getRutasOptimizada(data)
      if (posAct) {
        this.markers.push(0)
      }
      this.item = Object.assign({}, data) //TODO:verificar porque da error al cargar mapa despues cargar evaluacion y volver a cargar mapa en esta sentencia

      this.item.lat = this.coordenadas.latitude
      this.item.lng = this.coordenadas.longitude
      this.item.usuarios_id = this.$store.state.auth.authUser.id
      this.item.rutas_id = data.id
      this.item._noData = 1
      this.item.obs = ''
      this.item.id = null
      this.tituloModal =
        'Mapa Ruteo de ' + getDataLista(this.lRutas, this.item.rutas_id)
      this.modalMap = true
      setTimeout(() => {
        this.initMap()
      }, 300)
    },
    getDataLista(lista, valor, busco = 'id', devuelvo = 'name') {
      return getDataLista(lista, valor, busco, devuelvo)
    },
    change(e) {
      this.item.usuarios_id = this.lRutas.find((el) => el.id === e).usuarios_id
    },
    getPosition(callBack = false, id = -1) {
      let options = {
        enableHighAccuracy: true,
        timeout: 6000,
        maximumAge: 10,
      }
      this.callBack = callBack
      this.location = id
      navigator.geolocation.getCurrentPosition(
        this.successGps,
        this.errorGps,
        options
      )
    },
    successGps(position) {
      if (
        this.coordenadas.latitude != position.coords.latitude ||
        this.coordenadas.longitude != position.coords.longitude
      ) {
        this.coordenadas = position.coords
        this.item.lat = this.coordenadas.latitude
        this.item.lng = this.coordenadas.longitude
        console.log('Localizado', this.callBack)
        this.ordBeneficiarios(this.lRutas)
      }
      if (this.callBack != false) {
        this.callBack(this.location)
      }
      this.location = true
      this.callBack = false
    },
    errorGps(error) {
      this.location = false
      console.warn('ERROR(' + error.code + '): ' + error.message)
    },
    beforeOpen(accion, data = {}) {
      data.lat = this.coordenadas.latitude
      data.lng = this.coordenadas.longitude
    },
    getIcon(id) {
      if (id == 0) {
        return this.icon1
      } else {
        return this.icon2
      }
    },
    getMarker(id, item, index) {
      let marker = this.center
      if (id > 0) {
        let lmarker = this.lBeneficiarios.filter((e) => e.id == id)
        if (lmarker.length > 0) {
          marker = [lmarker[0].lat, lmarker[0].lng]
        }
      } else {
        marker = [this.coordenadas.latitude, this.coordenadas.longitude]
      }
      if (!item.beneficiarios) {
        return marker
      }

      if (index == item.beneficiarios.length - 1) {
        setTimeout(() => {
          this.fitMapBounds()
        }, 300)
      }
      return marker
    },
    initMap() {
      this.zoom = 13
      this.$refs.mymap.mapObject.invalidateSize().setView(this.center)
      this.fitMapBounds()
    },
    fitMapBounds() {
      let map = this.$refs.mymap.mapObject
      const visibleMarkers = []
      map.eachLayer(function (layer) {
        if (layer instanceof L.Marker) {
          visibleMarkers.push(layer)
        }
      })

      if (visibleMarkers.length > 0) {
        const markersBounds = L.latLngBounds([visibleMarkers[0].getLatLng()])
        visibleMarkers.forEach((marker) => {
          markersBounds.extend(marker.getLatLng())
        })

        map.flyToBounds(markersBounds, {
          padding: L.point(36, 36),
          animate: true,
        })
      }
    },
    getL(ruta) {
      return false
      const client = new TargomoClient('south_america', 'DF6SNYWF3ENCGQGGWEKU')
      let targets = ruta.beneficiarios.map((el) => {
        let marker = {
          id: el,
          lat: this.coordenadas.latitude,
          lng: this.coordenadas.longitude,
        }
        if (el > 0) {
          let lmarker = this.lBeneficiarios.filter((e) => e.id == el)
          if (lmarker.length > 0) {
            marker = { id: el, lat: lmarker[0].lat, lng: lmarker[0].lng }
          }
          return marker
        }
      })

      let source = {
        id: 0,
        lat: this.coordenadas.latitude,
        lng: this.coordenadas.longitude,
      }
      console.log('targets', targets)
      // The travel options used to determine which routes should be searched for
      const options = {
        travelType: 'car',
        maxEdgeWeight: 900,
        edgeWeight: 'time',
        pathSerializer: 'geojson',
        // yes, "polygon"... this comes from a legacy implementation when polygons were the only service.
        // Will be changing in the future to a more generalized approach.
        polygon: {
          srid: 4326,
        },
      }

      // Requesting routes from the Targomo API.
      client.routes.fetch([source], targets, options).then((result) => {
        console.log('rrrr:', result)
        this.jsonData = result
      })
    },
    async getRutas(ruta) {
      return false
      if (this.$nuxt.isOffline) {
        return false
      }
      //TODO: hacer cache de peticiones
      const client = new TargomoClient('south_america', 'DF6SNYWF3ENCGQGGWEKU')
      const routingConfig = {
        optimizationAlgorithm: 'GREEDY_TSP',
        optimizationTime: 1,
        stores: [
          {
            uuid: 'inicio',
            address: {
              lat: this.coordenadas.latitude,
              lng: this.coordenadas.longitude,
            },
          },
        ],
        orders: ruta.beneficiarios.map((f) => {
          return {
            uuid: getDataLista(this.lBeneficiarios, f),
            storeUuid: 'inicio',
            priority: 1,
            address: {
              lat: getDataLista(this.lBeneficiarios, f, 'id', 'lat'),
              lng: getDataLista(this.lBeneficiarios, f, 'id', 'lng'),
              avgHandlingTime: 1,
            },
          }
        }),
        transports: [
          {
            vehicle: {
              uuid: 'v1',
              storeUuid: 'inicio',
              priority: 1,
            },
          },
        ],
        optimizationMetadata: {
          geojsonCreation: 'ROUTING_SERVICE',
          travelOptions: {
            travelType: 'car',
            maxEdgeWeight: 1800,
            serviceUrl: 'https://api.targomo.com/south_america/',
            serviceKey: client.serviceKey,
          },
        },
      }

      //TODO: aqui otra formula para calcular habra que primero calcular elmas cercano del inicio y de ahi calcular todo de nuevo las distancias espaciales recursivamente hasta tener todo ordenado por distancia espacial..
      // let camino='';
      // ruta.beneficiarios.map(e=>{
      //   camino=camino+getDataLista(this.lBeneficiarios, e,'id','lat')+','+getDataLista(this.lBeneficiarios, e,'id','lng')+'/'
      // })
      // camino='https://www.google.com/maps/dir/'+camino+'/@'+this.coordenadas.latitude+','+this.coordenadas.longitude+',13z/data=!4m2!4m1!3e0'
      // console.log('camino',camino)

      const url = `https://api.targomo.com/fleetplanner/v1/api/key-auth/optimizations?key=${client.serviceKey}`
      try {
        const data = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(routingConfig),
        })
        const r = await data.json()
        //  console.log(r)

        let dd = [] //assign.Object([],r.tours[0].featureCollection.features)
        r.tours[0].featureCollection.features.forEach((d) => {
          if (d.geometry.type != 'Point') {
            dd.push(d)
          }
        })
        r.tours[0].featureCollection.features = dd

        this.jsonData = r.tours[0].featureCollection
      } catch (error) {
        console.error(error)
      }
    },
    ordBeneficiarios(lista) {
      lista.forEach((e) => {
        let r = []
        e.beneficiarios.forEach((el) => {
          r.push({
            id: el,
            distancia: this.distancia(
              getDataLista(this.lBeneficiarios, el, 'id', '*')
            ),
          })
        })
        r.sort(function (a, b) {
          return a.distancia - b.distancia
        })
        e.beneficiariosD = r
      })
      return lista
    },
  },
  computed: {
    binding() {
      const binding = {}
      if (this.$vuetify.breakpoint.xs) binding.column = true
      return binding
    },
    lPregCateg: (app) => (categ) => {
      let l = app.lPreguntas.filter((e) => e.categ_id == categ)

      console.log('categ:', categ, l)
      return l
    },
  },
  watch: {},
  async mounted() {
    this.getPosition()

    this.lUsuarios = await this.getListaBackend('monitores')
    this.lBeneficiarios = await this.getListaBackend('Beneficiarios', 'id,name')
    this.lRuteos = await this.getListaBackend('RuteosMonitor')

    let rutas = await this.getListaBackend(
      'Rutas',
      'id,name,usuarios_id,descrip'
    )

    this.lRutas = this.ordBeneficiarios(rutas)

    this.lCateg = await this.getListaBackend('Categ', 'id,name,orden')
    this.lPreguntas = await this.getListaBackend('Preguntas')
    this.lCateg.sort(function (a, b) {
      return a.orden - b.orden
    })

    this.lPreguntas.sort(function (a, b) {
      return a.orden - b.orden
    })

    let services = await this.getDataBackend('Servicios')
    services.forEach((e) => {
      e.cantidad = 1
      e.selected = false
    })
    this.lServicios = services
    //this.setOptionTable('del').visible=false;
  },
}
</script>
<style scoped>
</style>
